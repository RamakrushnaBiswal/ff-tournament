<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Free Fire Registration | Battle Royale Tournament</title>
    <link rel="icon" href="https://res.cloudinary.com/dmqpa2073/image/upload/v1758696167/fflogo_h7fzdr.png">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(120deg, #191a23 60%, #ff8800 100%);
        min-height: 100vh;
      }
      .glass {
        background: rgba(30, 30, 40, .75);
        backdrop-filter: blur(8px);
      }
    </style>
  </head>
  <body class="relative overflow-x-hidden">
    <%- include('partials/navbar') %>
    <div class="pt-16">
    <!-- Hero Section -->
  <div class="w-full h-screen flex flex-col justify-center items-center text-white relative">
      <img src="https://res.cloudinary.com/dmqpa2073/image/upload/v1758696112/bgimg_x1dquo.png"
    alt="Free Fire Tournament Banner"
    class="absolute inset-0 w-full h-full object-cover brightness-75" />

      <div class="glass px-8 py-20 rounded-3xl shadow-xl w-full max-w-5xl flex flex-col items-center">
        <h1 class="text-4xl md:text-5xl font-extrabold tracking-wide mb-4 text-orange-400 drop-shadow-lg">Free Fire Tournament</h1>
        <h2 class="text-2xl font-semibold mb-2">Battle Royale Registration Open!</h2>
        <p class="text-sm md:text-base mb-6 max-w-md text-center">Join the ultimate Free Fire tournament and prove your mettle! Compete for prizes, glory, and bragging rights.</p>
        
        <!-- Countdown Timer -->
        <div id="countdown" class="flex space-x-4 mb-8 text-center">
          <div><span id="days" class="text-3xl font-bold"></span><br>Days</div>
          <div><span id="hours" class="text-3xl font-bold"></span><br>Hours</div>
          <div><span id="minutes" class="text-3xl font-bold"></span><br>Minutes</div>
          <div><span id="seconds" class="text-3xl font-bold"></span><br>Seconds</div>
        </div>

        <div class="flex items-center gap-3">
          <% if (user) { %>
            <button id="registerBtn" class="bg-orange-500 hover:bg-orange-700 transition px-8 py-3 font-bold rounded-lg shadow-lg text-lg cursor-pointer">Register Now</button>
          <% } else { %>
            <button id="loginToRegisterBtn" class="bg-orange-500 hover:bg-orange-700 transition px-8 py-3 font-bold rounded-lg shadow-lg text-lg cursor-pointer">Login to Register</button>
          <% } %>
          <a href="https://drive.google.com/file/d/1UTb1fhTbY30zdHh5Kiy3XEQF1D-KJ6Tj" download class="bg-gray-800 hover:bg-gray-700 transition px-6 py-3 font-bold rounded-lg shadow-lg text-lg text-white border border-gray-700" target="_blank">Rules</a>
        </div>
      </div>
    </div>
    
    <!-- Registration Modal -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden p-10">
      <div class="min-h-screen flex items-center justify-center bg-gray-950 p-6">
  <div class="w-full max-w-5xl bg-gray-900/70 backdrop-blur-md shadow-2xl rounded-2xl border border-gray-700 p-8">
    
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold text-orange-400">Team Registration</h2>
      <button id="closeModal" class="text-2xl text-orange-400 hover:text-orange-600">&times;</button>
    </div>

    <!-- Content -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      
      <!-- Registration Form -->
      <form id="registerForm" class="space-y-4" enctype="multipart/form-data">
        <input
  class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400"
  type="text"
  name="teamName"
  placeholder="Team Name"
  required
/>

<input
  required
  class="w-full px-4 py-2 rounded-lg bg-gray-800 text-gray-400 border border-gray-600 cursor-not-allowed"
  type="email"
  name="email"
  value="<%= userEmail %>"
  <%= isAuthenticated ? 'readonly' : 'disabled' %>
  placeholder="Login required to auto-fill email"
/>

        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="leader" placeholder="Leader in-game name">

        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="p1" placeholder="P1 in-game name">
        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="p2" placeholder="P2 in-game name">
        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="p3" placeholder="P3 in-game name">
        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="p4" placeholder="Substitue in-game name">

        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400" type="text" name="transactionId" placeholder="Transaction ID / UTR">

        <label class="block text-sm text-gray-300">Upload Transaction Screenshot</label>
        <input required class="w-full px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-orange-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-orange-500 file:text-white hover:file:bg-orange-600" type="file" name="transactionScreenshot">

        <button type="submit" class="w-full bg-orange-500 text-white font-semibold px-4 py-2 rounded-lg hover:bg-orange-600 transition">Submit Registration</button>
      </form>

      <!-- QR Code -->
      <div class="flex flex-col items-center justify-center">
        <h3 class="text-xl font-semibold text-gray-300 mb-4">Scan to Pay</h3>
        <img src="https://res.cloudinary.com/dmqpa2073/image/upload/v1758696090/image_vt5hph.png" alt="QR Code for Payment" class="h-72 w-72 rounded-lg border border-gray-600 shadow-md">
        <p class="mt-4 text-sm text-gray-400 text-center">Please complete the payment and upload the transaction screenshot before submitting.</p>
      </div>
    </div>

    <!-- Success Message -->
    <p class="hidden text-green-400 mt-8 text-center font-medium" id="successMsg">
      Your team has been registered successfully.
      We will send you an email (<span class="text-orange-400"><%= userEmail || 'your email' %></span>) for confirmation details.
      <b>Join WhatsApp Group for further communication</b>
      <button class="mt-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600"><a href=""></a></button>
    </p>
  </div>
</div>

    </div>

    <script>
      // Countdown timer JS (Set your tournament deadline)
      const deadline = new Date("2025-09-30T18:00:00").getTime();
      const updateCountdown = () => {
        const now = new Date().getTime();
        const dist = deadline - now;
        document.getElementById('days').innerText = Math.floor(dist / (1000 * 60 * 60 * 24));
        document.getElementById('hours').innerText = Math.floor((dist / (1000 * 60 * 60)) % 24);
        document.getElementById('minutes').innerText = Math.floor((dist / (1000 * 60)) % 60);
        document.getElementById('seconds').innerText = Math.floor((dist / 1000) % 60);
      };
      setInterval(updateCountdown, 1000);
      updateCountdown();

      // Modal JS
  const registerBtn = document.getElementById('registerBtn');
  const loginToRegisterBtn = document.getElementById('loginToRegisterBtn');
  const modalOverlay = document.getElementById('modalOverlay');
      const closeModal = document.getElementById('closeModal');
      const registerForm = document.getElementById('registerForm');
      const successMsg = document.getElementById('successMsg');
      if (registerBtn) {
        registerBtn.onclick = () => { modalOverlay.classList.remove('hidden'); };
      }
      if (loginToRegisterBtn) {
        loginToRegisterBtn.onclick = () => { window.location.href = '/auth/google'; };
      }
      closeModal.onclick = () => { modalOverlay.classList.add('hidden'); successMsg.classList.add('hidden'); };
      registerForm.onsubmit = async (e) => {
  e.preventDefault();
  const formData = new FormData(registerForm);

  try {
    const res = await fetch(`${process.env.API_URL}/api/team/register`, {
      method: "POST",
      body: formData,
    });
    const data = await res.json();

    if (data.success) {
      successMsg.classList.remove("hidden");
      registerForm.reset();
      setTimeout(() => {
        modalOverlay.classList.add("hidden");
        successMsg.classList.add("hidden");
      }, 2000);
    } else {
      alert("Error: " + (data.message || JSON.stringify(data.errors)));
    }
  } catch (err) {
    alert("Server error");
  }
};
    </script>
  </body>
  <%- include('partials/footer') %>
</html>